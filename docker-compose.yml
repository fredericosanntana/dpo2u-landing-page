version: '3.9'

services:
  dpo2u:
    container_name: dpo2u-landing-page
    build:
      context: .
      dockerfile: Dockerfile
    restart: always
    expose:
      - "3000"
    environment:
      - API_GATEWAY_URL=http://172.17.0.1:8090 # Kept for reference, though client-side calls might need these via VITE_ env vars
    labels:
      - "traefik.enable=true"
      # HTTP Router
      - "traefik.http.routers.dpo2u.rule=Host(`dpo2u.com`) || Host(`www.dpo2u.com`)"
      - "traefik.http.routers.dpo2u.entrypoints=web"
      - "traefik.http.routers.dpo2u.service=dpo2u"
      # HTTPS Router
      - "traefik.http.routers.dpo2u-secure.rule=Host(`dpo2u.com`) || Host(`www.dpo2u.com`)"
      - "traefik.http.routers.dpo2u-secure.entrypoints=websecure"
      - "traefik.http.routers.dpo2u-secure.tls=true"
      - "traefik.http.routers.dpo2u-secure.tls.certresolver=myresolver"
      - "traefik.http.routers.dpo2u-secure.service=dpo2u"
      # Service definition - Express listens on 3000 inside container
      - "traefik.http.services.dpo2u.loadbalancer.server.port=3000"
    networks:
      - tweb
    volumes:
      - ./public/downloads:/app/public/downloads

networks:
  tweb:
    external: true
